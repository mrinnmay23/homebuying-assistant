<!--<!DOCTYPE html>-->
<!--<html>-->
<!--<head><meta charset="UTF-8"><title>Offer Score</title></head>-->
<!--<body>-->
<!--<h1>Offer Score</h1>-->
<!--<a th:href="@{/}">&larr; Home</a>-->
<!--<form id="form">-->
<!--    <label>Rate (%): <input id="rate" type="number" step="0.01"/></label><br/>-->
<!--    <label>Fees:     <input id="fees" type="number" step="0.01"/></label><br/>-->
<!--    <button>Compute</button>-->
<!--</form>-->
<!--<pre id="out"></pre>-->

<!--<script>-->
<!--    document.getElementById('form').addEventListener('submit', async e=>{-->
<!--        e.preventDefault();-->
<!--        const r = document.getElementById('rate').value,-->
<!--            f = document.getElementById('fees').value;-->
<!--        const res = await fetch(`/api/score?rate=${r}&fees=${f}`);-->
<!--        const ans = await res.json();-->
<!--        document.getElementById('out').textContent = JSON.stringify(ans, null, 2);-->
<!--    });-->
<!--</script>-->
<!--</body>-->
<!--</html>-->


<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Offer Score</title>

    <!-- Bootswatch Cosmo theme -->
    <link
            href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.2/dist/cosmo/bootstrap.min.css"
            rel="stylesheet"
    />

    <style>
        body {
            background: url('/images/background.jpg') no-repeat center center fixed;
            background-size: cover;
        }
        .card-transparent {
            background: rgba(255,255,255,0.85);
            border-radius: .5rem;
            padding: 2rem;
            max-width: 600px;
            margin: 2rem auto;
        }
    </style>
</head>
<body class="bg-light">

<!-- navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
    <div class="container">
        <a class="navbar-brand" th:href="@{/}">Homebuying Assistant</a>
        <div class="navbar-nav">
            <a class="nav-link" th:href="@{/chat}">Chat</a>
            <a class="nav-link" th:href="@{/quotes}">Quotes</a>
            <a class="nav-link" th:href="@{/calculator}">Calculator</a>
            <a class="nav-link active" th:href="@{/score}">Offer Score</a>
        </div>
    </div>
</nav>

<div class="container">
    <a th:href="@{/}" class="btn btn-outline-secondary mb-3">‚Üê Home</a>

    <div class="card-transparent">
        <h2 class="mb-4">Offer Quality Score</h2>

        <form id="score-form" class="row g-3 mb-4">
            <div class="col-md-6">
                <input
                        id="rate"
                        type="number"
                        step="0.01"
                        min="0"
                        class="form-control"
                        placeholder="Rate (%)"
                        required
                />
            </div>
            <div class="col-md-6">
                <input
                        id="fees"
                        type="number"
                        step="0.01"
                        min="0"
                        class="form-control"
                        placeholder="Fees"
                        required
                />
            </div>
            <div class="col-12 text-center">
                <button type="submit" class="btn btn-primary">Compute Score</button>
            </div>
        </form>

        <div
                id="score-result"
                class="alert alert-info"
                style="display:none;"
        ></div>
    </div>
</div>

<script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
></script>

<script>
    const form   = document.getElementById('score-form'),
        result = document.getElementById('score-result');

    form.addEventListener('submit', async e => {
        e.preventDefault();

        const r = document.getElementById('rate').value,
            f = document.getElementById('fees').value;

        // build API URL
        const url = `/api/score?rate=${encodeURIComponent(r)}&fees=${encodeURIComponent(f)}`;

        try {
            const resp = await fetch(url);
            const body = await resp.json();
            // show the percentile
            result.style.display = 'block';
            result.textContent = `Your offer is in the top ${body.percentile.toFixed(1)}% of historical loans.`;
        } catch (err) {
            result.style.display = 'block';
            result.className = 'alert alert-danger';
            result.textContent = 'Error computing score.';
        }
    });
</script>

</body>
</html>
