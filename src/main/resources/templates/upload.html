<!--<!DOCTYPE html>-->
<!--<html>-->
<!--<head><meta charset="UTF-8"><title>Upload Loan PDF</title></head>-->
<!--<body>-->
<!--<h1>Upload Loan Estimate PDF</h1>-->
<!--<a th:href="@{/}">&larr; Home</a>-->
<!--<form id="form" enctype="multipart/form-data">-->
<!--    <input type="file" name="file" accept="application/pdf"/><br/>-->
<!--    <button>Upload</button>-->
<!--</form>-->
<!--<pre id="out"></pre>-->
<!--<script>-->
<!--    document.getElementById('form').addEventListener('submit', async e=>{-->
<!--        e.preventDefault();-->
<!--        const fd = new FormData(e.target);-->
<!--        const res = await fetch('/api/pdf/upload', {-->
<!--            method: 'POST',-->
<!--            body: fd-->
<!--        });-->
<!--        const ans = await res.json();-->
<!--        document.getElementById('out').textContent = JSON.stringify(ans, null, 2);-->
<!--    });-->
<!--</script>-->
<!--</body>-->
<!--</html>-->


<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Upload Loan Estimate PDF</title>

    <!-- Bootswatch Cosmo theme -->
    <link
            href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.2/dist/cosmo/bootstrap.min.css"
            rel="stylesheet"
    />
    <style>
        body {
            background: url('/images/background.jpg') no-repeat center center fixed;
            background-size: cover;
        }
        .card-transparent {
            background: rgba(255,255,255,0.85);
            border-radius: .5rem;
            padding: 2rem;
            max-width: 600px;
            margin: 2rem auto;
        }
    </style>
</head>
<body class="bg-light">

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
    <div class="container">
        <a class="navbar-brand" th:href="@{/}">Homebuying Assistant</a>
        <div class="navbar-nav">
            <a class="nav-link" th:href="@{/chat}">Chat</a>
            <a class="nav-link" th:href="@{/quotes}">Quotes</a>
            <a class="nav-link" th:href="@{/calculator}">Calculator</a>
            <a class="nav-link" th:href="@{/score}">Offer Score</a>
            <a class="nav-link" th:href="@{/amortization}">Amortization</a>
            <a class="nav-link" th:href="@{/refinance}">Refinance</a>
            <a class="nav-link active" th:href="@{/upload-pdf}">PDF Upload</a>
        </div>
    </div>
</nav>

<div class="container">
    <a th:href="@{/}" class="btn btn-outline-secondary mb-3">← Home</a>

    <div class="card-transparent text-center">
        <h2 class="mb-4">Upload Loan Estimate PDF</h2>

        <form id="pdf-form" enctype="multipart/form-data" class="mb-4">
            <input
                    type="file"
                    name="file"
                    accept="application/pdf"
                    class="form-control mb-3"
                    required
            />
            <button type="submit" class="btn btn-primary">Upload</button>
        </form>

        <div id="result" class="text-start"></div>
    </div>
</div>

<script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
></script>
<script th:inline="javascript">
    /*<![CDATA[*/
    const form   = document.getElementById('pdf-form'),
        result = document.getElementById('result');

    form.addEventListener('submit', async e => {
        e.preventDefault();
        result.innerHTML = '<em>Uploading…</em>';

        const fd  = new FormData(form),
            res = await fetch('/api/pdf/upload', {
                method: 'POST',
                body: fd
            }),
            json = await res.json();

        if (json.error) {
            result.innerHTML = `<div class="alert alert-danger">${json.error}</div>`;
            return;
        }

        // Render fields as a table
        const fields = json.fields || {},
            rows   = Object.entries(fields)
                .map(([k,v]) =>
                    `<tr><th scope="row">${k}</th><td>${v}</td></tr>`)
                .join('');

        result.innerHTML = `
        <h4>Extracted Fields:</h4>
        <div class="table-responsive">
          <table class="table table-bordered">
            <tbody>${rows}</tbody>
          </table>
        </div>
      `;
    });
    /*]]>*/
</script>
</body>
</html>
